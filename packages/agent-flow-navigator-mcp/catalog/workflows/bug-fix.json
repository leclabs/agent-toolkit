{
  "id": "bug-fix",
  "name": "Bug Fix",
  "description": "Workflow for fixing bugs: reproduce, investigate, fix, verify, and create PR.",
  "nodes": {
    "start": {
      "type": "start",
      "name": "Start",
      "description": "Bug fix begins"
    },
    "reproduce": {
      "type": "task",
      "name": "Reproduce Bug",
      "description": "Understand the bug and create a reliable reproduction case",
      "agent": "flow:Investigator",
      "emoji": "üîç",
      "stage": "investigation"
    },
    "investigate": {
      "type": "task",
      "name": "Investigate",
      "description": "Find root cause by tracing code paths and debugging",
      "agent": "flow:Investigator",
      "emoji": "üîç",
      "stage": "investigation"
    },
    "write_fix": {
      "type": "task",
      "name": "Write Fix",
      "description": "Implement the fix with minimal changes",
      "agent": "flow:Developer",
      "emoji": "üîß",
      "stage": "development"
    },
    "add_regression_test": {
      "type": "task",
      "name": "Add Regression Test",
      "description": "Write a test that would have caught this bug",
      "agent": "flow:Tester",
      "emoji": "üß™",
      "stage": "development"
    },
    "verify_fix": {
      "type": "task",
      "name": "Verify Fix",
      "description": "Run all tests and verify the bug is fixed",
      "agent": "flow:Tester",
      "emoji": "üß™",
      "stage": "verification",
      "maxRetries": 3
    },
    "lint_format": {
      "type": "gate",
      "name": "Lint & Format",
      "description": "Run lint and format checks. Auto-fix issues where possible.",
      "agent": "flow:Developer",
      "emoji": "üîß",
      "stage": "delivery",
      "maxRetries": 3
    },
    "commit": {
      "type": "task",
      "name": "Commit Changes",
      "description": "Commit the fix and regression test with a descriptive message",
      "agent": "flow:Developer",
      "emoji": "üîß",
      "stage": "delivery"
    },
    "end_success": {
      "type": "end",
      "result": "success",
      "name": "Fixed",
      "description": "Bug fixed and PR created"
    },
    "hitl_cannot_reproduce": {
      "type": "end",
      "result": "blocked",
      "escalation": "hitl",
      "name": "Cannot Reproduce",
      "description": "Unable to reproduce the bug - need more info"
    },
    "hitl_fix_failed": {
      "type": "end",
      "result": "blocked",
      "escalation": "hitl",
      "name": "Fix Failed",
      "description": "Unable to fix the bug - needs human help"
    }
  },
  "edges": [
    {
      "from": "start",
      "to": "reproduce"
    },
    {
      "from": "reproduce",
      "to": "investigate",
      "on": "passed",
      "label": "Bug reproduced successfully"
    },
    {
      "from": "reproduce",
      "to": "hitl_cannot_reproduce",
      "on": "failed",
      "label": "Could not reproduce bug"
    },
    {
      "from": "investigate",
      "to": "write_fix"
    },
    {
      "from": "write_fix",
      "to": "add_regression_test"
    },
    {
      "from": "add_regression_test",
      "to": "verify_fix"
    },
    {
      "from": "verify_fix",
      "to": "write_fix",
      "on": "failed",
      "label": "Fix didn't work, try again"
    },
    {
      "from": "verify_fix",
      "to": "hitl_fix_failed",
      "on": "failed",
      "label": "Cannot fix the bug"
    },
    {
      "from": "verify_fix",
      "to": "lint_format",
      "on": "passed",
      "label": "Bug verified fixed, run lint checks"
    },
    {
      "from": "lint_format",
      "to": "commit",
      "on": "passed",
      "label": "Lint passes, commit changes"
    },
    {
      "from": "lint_format",
      "to": "write_fix",
      "on": "failed",
      "label": "Fix lint/format issues"
    },
    {
      "from": "lint_format",
      "to": "hitl_fix_failed",
      "on": "failed",
      "label": "Lint issues persist"
    },
    {
      "from": "commit",
      "to": "end_success"
    },
    {
      "from": "hitl_cannot_reproduce",
      "to": "reproduce",
      "on": "passed",
      "label": "Human provided reproduction info, resume"
    },
    {
      "from": "hitl_fix_failed",
      "to": "write_fix",
      "on": "passed",
      "label": "Human resolved fix issue, resume"
    }
  ]
}
